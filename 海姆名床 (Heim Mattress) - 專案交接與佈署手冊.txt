æµ·å§†ååºŠ (Heim Mattress) - å°ˆæ¡ˆäº¤æ¥èˆ‡ä½ˆç½²æ‰‹å†Š
ç‰ˆæœ¬ï¼š HeimOS 3.3 (Banana Pro Ready)
æ—¥æœŸï¼š 2025/01
ç›®æ¨™ç’°å¢ƒï¼š Vercel (Frontend/Edge) + Supabase (Database/Auth)
1. å°ˆæ¡ˆæ¦‚è¿° (Project Overview)
ã€Œæµ·å§†ååºŠã€æ˜¯ä¸€å€‹æ·±åº¦éŠæˆ²åŒ– (Gamification) çš„å®¢è£½åŒ–åºŠå¢Šé›»å•†ç¶²ç«™ã€‚è¨­è¨ˆéˆæ„Ÿæºè‡ªã€Šé›†åˆå•¦ï¼å‹•ç‰©æ£®å‹æœƒã€‹ï¼Œæ—¨åœ¨å°‡æ¯ç‡¥çš„å®¶å…·é¸è³¼éç¨‹è½‰åŒ–ç‚ºæœ‰è¶£çš„ã€Œç„¡äººå³¶ç§»å±…è¨ˆç•«ã€ã€‚
æ ¸å¿ƒåƒ¹å€¼
æ²‰æµ¸å¼é«”é©—ï¼šå…¨ç«™æ¡ç”¨æ“¬ç‰©åŒ–è¨­è¨ˆ (Skeuomorphic Design)ã€å‹•æ…‹è¦–å·®èƒŒæ™¯ã€éŸ³æ•ˆäº’å‹•èˆ‡éŠæˆ²åŒ–æˆå°±ç³»çµ±ã€‚
AI é©…å‹• (Gemini)ï¼š
å“ˆå§†åº—é•· (AI Consultant)ï¼šé€é RAG (Rule-based + AI) åˆ†æç”¨æˆ¶ç¡çœ ç¿’æ…£ï¼Œæ¨è–¦åºŠå¢Šé…ç½®ã€‚
AI SEO (GEO)ï¼šè‡ªå‹•ç”Ÿæˆçµæ§‹åŒ–è³‡æ–™ (JSON-LD) èˆ‡å„ªåŒ–å¾Œçš„å•†å“æè¿°ã€‚
é¢¨æ ¼è½‰æ› (Banana Pro)ï¼šå¾Œå°æ•´åˆå½±åƒç”ŸæˆåŠŸèƒ½ï¼Œå°‡æ™®é€šç…§ç‰‡è½‰æ›ç‚ºå‹•æ£®é¢¨æ ¼ã€‚
å®Œå…¨å®¢è£½åŒ– (DIY)ï¼šå‰ç«¯å³æ™‚æ¸²æŸ“åºŠå¢Šåˆ†å±¤çµæ§‹ï¼ˆè¡¨å¸ƒã€èˆ’é©å±¤ã€æ”¯æ’å±¤ï¼‰ï¼Œä¸¦å³æ™‚è¨ˆç®—åƒ¹æ ¼ã€‚
2. æŠ€è¡“æ¶æ§‹ (Architecture)
å‰ç«¯æŠ€è¡“å †ç–Š
Framework: React 19
Build Tool: Vite (ç›®å‰é€é Custom Loader é‹è¡Œï¼Œé·ç§»è‡³ Vercel å»ºè­°ä½¿ç”¨æ¨™æº– Vite é…ç½®)
Styling: Tailwind CSS (åŒ…å«è‡ªå®šç¾©å‹•ç•«èˆ‡å‹•æ£®é…è‰²ç³»çµ±)
Routing: React Router DOM (HashRouter currently, recommend BrowserRouter for Vercel)
AI Integration: Google GenAI SDK (@google/genai)
SEO: React Helmet Async
è³‡æ–™å±¤ (ç›®å‰ vs ç›®æ¨™)
Current (Dev/Test): services/dataService.ts ä½¿ç”¨ localStorage æ¨¡æ“¬ CRUDï¼Œè³‡æ–™åƒ…å­˜åœ¨æ–¼ä½¿ç”¨è€…ç€è¦½å™¨ã€‚
Target (Production): Supabase (PostgreSQL) ç”¨æ–¼å„²å­˜è¨‚å–®ã€å•†å“ã€éƒ¨è½æ ¼æ–‡ç« èˆ‡æœƒå“¡è³‡æ–™ã€‚
3. ç›®éŒ„çµæ§‹èªªæ˜ (Directory Structure)
code
Code
/
â”œâ”€â”€ components/         # UI å…ƒä»¶åº«
â”‚   â”œâ”€â”€ Header.tsx      # å°è¦½åˆ— (å«å‹•æ…‹æ™‚é–“ã€å¤©æ°£)
â”‚   â”œâ”€â”€ MattressBuilder.tsx # æ ¸å¿ƒåŠŸèƒ½ï¼šåºŠå¢Š DIY å·¥åŠ
â”‚   â”œâ”€â”€ AdminPage.tsx   # å¾Œå°ç®¡ç†ç³»çµ± (CMS)
â”‚   â”œâ”€â”€ SEO.tsx         # SEO & JSON-LD æ³¨å…¥å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ dataService.ts  # è³‡æ–™å­˜å–å±¤ (éœ€é‡å¯«ä»¥ä¸²æ¥ Supabase)
â”‚   â”œâ”€â”€ geminiService.ts# Google Gemini AI ä¸²æ¥é‚è¼¯
â”‚   â””â”€â”€ recommendationLogic.ts # ç¡çœ æ¨è–¦æ¼”ç®—æ³•
â”œâ”€â”€ types.ts            # TypeScript å‹åˆ¥å®šç¾© (Data Models)
â”œâ”€â”€ constants.ts        # éœæ…‹è³‡æ–™ (é è¨­å•†å“ã€æè³ªåƒæ•¸)
â”œâ”€â”€ App.tsx             # ä¸»ç¨‹å¼èˆ‡è·¯ç”±é…ç½®
â””â”€â”€ index.tsx           # é€²å…¥é»
4. ç’°å¢ƒè®Šæ•¸è¨­å®š (Environment Variables)
åœ¨ Vercel éƒ¨ç½²æ™‚ï¼Œè«‹è¨­å®šä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ï¼š
è®Šæ•¸åç¨±	æè¿°	ç¯„ä¾‹å€¼
API_KEY	Google Gemini API Key (å¿…é ˆæ”¯æ´ä»˜è²»å°ˆæ¡ˆä»¥ä½¿ç”¨ Pro æ¨¡å‹)	AIzaSy...
VITE_SUPABASE_URL	(ç”Ÿç”¢ç’°å¢ƒéœ€æ–°å¢) Supabase å°ˆæ¡ˆç¶²å€	https://xyz.supabase.co
VITE_SUPABASE_ANON_KEY	(ç”Ÿç”¢ç’°å¢ƒéœ€æ–°å¢) Supabase å…¬é–‹é‡‘é‘°	eyJhbG...
5. ç”Ÿç”¢ç’°å¢ƒé·ç§»æŒ‡å— (Migration Guide: LocalStorage to Supabase)
æ­¤ç« ç¯€æ˜¯äº¤æ¥çµ¦å¾ŒçºŒå·¥ç¨‹å¸«çš„é—œéµã€‚ç›®å‰çš„ dataService.ts æ˜¯ä¸€å€‹ Facadeï¼Œæ‚¨éœ€è¦å»ºç«‹ Supabase è¡¨æ ¼ä¸¦ä¿®æ”¹ Service å±¤ã€‚
æ­¥é©Ÿ A: Supabase è³‡æ–™åº«è¦åŠƒ (SQL Schema)
è«‹åœ¨ Supabase SQL Editor åŸ·è¡Œä»¥ä¸‹è…³æœ¬ä»¥å»ºç«‹å°æ‡‰çš„è¡¨æ ¼ï¼š
code
SQL
-- 1. Products (å•†å“è¡¨)
create table products (
  id text primary key,
  name text not null,
  category text,
  price integer,
  description text,
  full_description text,
  image_prompt text,
  uploaded_image text, -- Store Base64 or Storage URL
  tags text[], -- Array of strings
  features jsonb, -- JSON array
  specs jsonb, -- JSON array
  variants jsonb, -- JSON array
  seo jsonb,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 2. Orders (è¨‚å–®è¡¨)
create table orders (
  id text primary key,
  customer_name text,
  items jsonb not null, -- Store cart items snapshot
  total_amount integer,
  status text default 'PENDING',
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 3. Blog Posts (éƒ¨è½æ ¼)
create table blog_posts (
  id text primary key,
  title text,
  excerpt text,
  content text, -- HTML content
  category text,
  author text,
  date date,
  tags text[],
  image_prompt text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 4. User Profiles (æœƒå“¡è³‡æ–™ - å¯èˆ‡ Supabase Auth æ•´åˆ)
create table profiles (
  id uuid references auth.users on delete cascade,
  name text,
  island_name text,
  title text,
  miles integer default 0,
  unlocked_stamps text[],
  last_check_in date,
  primary key (id)
);
æ­¥é©Ÿ B: ä¿®æ”¹ services/dataService.ts
è«‹å°‡åŸæœ¬è®€å¯« localStorage çš„é‚è¼¯ï¼Œæ”¹ç‚ºå‘¼å« Supabase Clientã€‚
ç¯„ä¾‹ä»£ç¢¼ (è™›æ“¬ç¢¼)ï¼š
code
TypeScript
// å®‰è£: npm install @supabase/supabase-js
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  import.meta.env.VITE_SUPABASE_URL,
  import.meta.env.VITE_SUPABASE_ANON_KEY
);

class DataService {
  // ç¯„ä¾‹ï¼šå–å¾—å•†å“
  async getProducts(): Promise<Product[]> {
    const { data, error } = await supabase.from('products').select('*');
    if (error) throw error;
    return data as Product[]; // éœ€åšæ¬„ä½æ˜ å°„è™•ç† (snake_case to camelCase)
  }

  // ç¯„ä¾‹ï¼šå»ºç«‹è¨‚å–®
  async createOrder(items: CartItem[], totalAmount: number): Promise<Order> {
    const newOrder = {
        customer_name: 'Guest', // æˆ–å¾ Auth å–å¾—
        items: items,
        total_amount: totalAmount,
        status: 'PENDING'
    };
    const { data, error } = await supabase.from('orders').insert(newOrder).select();
    return data[0];
  }
  
  // ... å…¶ä»–æ–¹æ³• (getBlogPosts, saveUserProfile ç­‰) ä¾æ­¤é¡æ¨
}
æ­¥é©Ÿ C: åœ–ç‰‡å„²å­˜ç­–ç•¥ (Storage Strategy)
ç›®å‰çš„æ‡‰ç”¨ä½¿ç”¨ Base64 å­—ä¸²å„²å­˜åœ–ç‰‡ (ç‚ºäº†æ–¹ä¾¿ Demo)ã€‚
ç”Ÿç”¢ç’°å¢ƒå»ºè­°ï¼š
åœ¨ Supabase å•Ÿç”¨ Storage åŠŸèƒ½ï¼Œå»ºç«‹ä¸€å€‹ public bucket (ä¾‹å¦‚ heim-assets)ã€‚
åœ¨ AdminPage.tsx ä¸Šå‚³åœ–ç‰‡æ™‚ï¼Œå°‡æª”æ¡ˆä¸Šå‚³è‡³ Supabase Storageï¼Œä¸¦å–å¾—å…¬é–‹ URLã€‚
å°‡ URL å­˜å…¥ Databaseï¼Œè€Œé Base64 å­—ä¸²ï¼Œä»¥å„ªåŒ–è¼‰å…¥æ•ˆèƒ½ã€‚
6. éƒ¨ç½²è‡³ Vercel (Deployment)
æº–å‚™ Repositoryï¼šå°‡åŒ…å« package.json, vite.config.ts (éœ€æ–°å¢), index.html, src/ çš„å®Œæ•´å°ˆæ¡ˆæ¨é€åˆ° GitHub/GitLabã€‚
Vercel Project Setupï¼š
Import Repositoryã€‚
Framework Preset é¸æ“‡ Viteã€‚
Build Command: npm run build (ç¢ºä¿ package.json æœ‰ build script: tsc && vite build)ã€‚
Output Directory: distã€‚
è¨­å®šç’°å¢ƒè®Šæ•¸ï¼šåœ¨ Vercel Project Settings > Environment Variables å¡«å…¥ä¸Šè¿°çš„ API Keysã€‚
Deployï¼šé»æ“Š Deployã€‚
7. å¾Œå°åŠŸèƒ½èªªæ˜ (Admin Manual)
ç¶²ç«™å…§å»ºä¸€å€‹å¼·å¤§çš„ CMS ç³»çµ±ï¼Œä¾›ç‡Ÿé‹äººå“¡ä½¿ç”¨ã€‚
é€²å…¥æ–¹å¼ï¼š
é›»è…¦ç‰ˆï¼šé»æ“Š Footer ç‰ˆæ¬Šå®£å‘Šå€å¡Šä¸­çš„ã€Œçµ±ä¸€ç·¨è™Ÿã€æ–‡å­—é€£çºŒ 5æ¬¡ã€‚
æˆ–ç›´æ¥è¼¸å…¥ç¶²å€ /#/admin (HashRouter) æˆ– /admin (BrowserRouter)ã€‚
é è¨­ç™»å…¥å¯†ç¢¼ï¼šhamu888 (è«‹åœ¨ç”Ÿç”¢ç’°å¢ƒä»£ç¢¼ä¸­ä¿®æ”¹æ­¤é©—è­‰é‚è¼¯ï¼Œå»ºè­°æ”¹ç”¨ Supabase Auth)ã€‚
åŠŸèƒ½æ¨¡çµ„ï¼š
ç‡Ÿé‹å„€è¡¨æ¿ï¼šæŸ¥çœ‹ç‡Ÿæ”¶æ¦‚æ³ã€å¾…è™•ç†è¨‚å–®ã€‚
è¨‚å–®ç®¡ç†ï¼šæ›´æ”¹è¨‚å–®ç‹€æ…‹ (å¾…è™•ç† -> è™•ç†ä¸­ -> å®Œæˆ)ã€‚
å•†å“ä¸­å¿ƒï¼šä¸Šå‚³å•†å“ã€AI è‡ªå‹•ç”Ÿæˆæè¿°ã€AI è‡ªå‹•ç”Ÿæˆ SEO æ¨™ç±¤ã€‚
å·¥åŠç®¡ç†ï¼šæ–°å¢/ä¿®æ”¹ DIY åºŠå¢Šçš„ææ–™ (è¡¨å¸ƒã€å½ˆç°§ã€æ³¡æ£‰) èˆ‡åƒ¹æ ¼ã€‚
é¢¨æ ¼è½‰æ›å™¨ï¼šä¸Šå‚³å¯¦æ‹ç…§ç‰‡ï¼Œé€é Gemini Pro Vision è½‰æ›ç‚ºã€Œå‹•æ£®é¢¨æ ¼ã€å®£å‚³åœ–ã€‚
æ—¥èªŒä¸­å¿ƒï¼šæ’°å¯«éƒ¨è½æ ¼ï¼Œæ”¯æ´ AI éˆæ„Ÿæ’°å¯« (è‡ªå‹•ç”Ÿæˆç¬¦åˆ SEO çš„è¡›æ•™æ–‡ç« )ã€‚
ç³»çµ±è¨­å®šï¼šè¨­å®šé¦–é å…¬å‘Šã€éš¨æ©Ÿæ°£çƒæ´»å‹• (Balloon Event) çš„å„ªæƒ ç¢¼ã€‚
8. çµèªèˆ‡äº¤æ¥æ³¨æ„äº‹é …
Gemini API é…é¡ï¼šç›®å‰çš„ AI åŠŸèƒ½ä¾è³´ Gemini APIã€‚è«‹ç•™æ„ Google Cloud Console çš„é…é¡ä½¿ç”¨é‡ï¼Œå»ºè­°è¨­å®š Billing Alertã€‚
Line æ•´åˆï¼šçµå¸³æµç¨‹ç›®å‰æ˜¯ç”¢ç”Ÿ Deep Link è·³è½‰è‡³ Lineã€‚è‹¥éœ€è‡ªå‹•åŒ–æ¨æ’­ï¼Œéœ€å¦å¤–ä¸²æ¥ Line Messaging API Webhook åˆ° Supabase Edge Functionsã€‚
è¡Œå‹•ç‰ˆå„ªåŒ–ï¼šç›®å‰ CSS å·²é‡å° iOS Safari çš„ Safe Area é€²è¡Œå„ªåŒ–ï¼Œä½†åœ¨ä¿®æ”¹ Layout æ™‚è«‹å‹™å¿…æª¢æŸ¥ bottom-24 ç­‰é‡å° Bottom Navigation çš„æ¨ç§»è¨­å®šã€‚
é€™æ˜¯ä¸€å€‹å……æ»¿æ„›èˆ‡å‰µæ„çš„å°ˆæ¡ˆï¼Œç¥æ‚¨åœ¨æµ·å§†å³¶çš„é–‹ç™¼æ—…ç¨‹æ„‰å¿«ï¼ ğŸï¸ğŸ¹ğŸ’¤